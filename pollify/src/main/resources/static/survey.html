<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link href="/css/home.css" rel="stylesheet">
    <link href="/css/user.css" rel="stylesheet">
    <link href="/css/create.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/result.css">
    <link rel="stylesheet" href="/css/survey.css">
    <title>Pollify - Vote</title>
</head>

<body>
    <nav class="navbar">
        <div class="logo">
            <h1>Pollify</h1>
        </div>
        <div>
        </div>
    </nav>

    <section id="vote-section" class="container-fluid m-auto survey-form-container mt-5">
        <div class="survey-form-element">
            <h1 id="survey-title" class="survey-heading mb-4">Survey name</h1>
            <form id="voteForm">
                <div id="questions-container"></div>
            </form>
        </div>
    </section>
</body>

<script>
     document.addEventListener("DOMContentLoaded", async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const surveyId = urlParams.get("id");

        if (!surveyId) {
            alert("No survey ID provided.");
            return;
        }

        try {
            const res = await fetch(`/api/surveys/${surveyId}`, {
                method: "GET",
                credentials: "include"
            });

            if (!res.ok) throw new Error("Failed to load survey");

            const data = await res.json();

            document.getElementById("survey-title").textContent = data.title;

            const container = document.getElementById("questions-container");
            container.innerHTML = "";

            data.questions.forEach((q, index) => {
                const questionEl = document.createElement("div");
                questionEl.className = "vote-form-card";
                questionEl.innerHTML = `
                    <label class="question-label">${index + 1}. ${q.text}</label>
                `;
                container.appendChild(questionEl);
            });
        } catch (err) {
            console.error(err);
            alert("Could not fetch survey details.");
        }
    });
</script>

</html>